# 1 glmnet-------------------------------------------
if(runGLMnet)  {
## Run inner CV
glmnet.fit = train(x = train[,x], y = train[,y],
method = "glmnet", metric = "RMSE",
trControl = fitControl,
tuneGrid = glmnet.tuneGrid)
## Save index row to save fit.stats output
fit.stats.index = which(fit.stats$num_repeat == repeats &
fit.stats$k == outer &
fit.stats$model == "glmnet")
## Save final tuning parameters
fit.stats[fit.stats.index, c("alpha", "lambda")] = glmnet.fit$finalModel$tuneValue
## Predict in independent test set
glmnet.preds = predict(glmnet.fit, newdata = test)
# Save fit statistics
fit.stats[fit.stats.index, c("RMSE", "Rsquared", "MAE")] =
postResample(test[, y], glmnet.preds)
## Save variable importance
glmnet.varImp = varImp(glmnet.fit)$importance
# save variable label and order by label
glmnet.varImp$vars = row.names(glmnet.varImp)
glmnet.varImp = arrange(glmnet.varImp, vars)
# Save importance values
varImp.stats[fit.stats.index, sort(x)] = glmnet.varImp$Overall
}
# 2 rf-----------------------------------------------
if(runRF == TRUE) {
## Run inner CV
rf.fit = train(x = train[,x], y = train[,y],
method = "rf", metric = "RMSE",
trControl = fitControl,
tuneGrid = rf.tuneGrid
)
## Save index row to save fit.stats output
fit.stats.index = which(fit.stats$num_repeat == repeats &
fit.stats$k == outer &
fit.stats$model == "rf")
## Save final tuning parameters
fit.stats[fit.stats.index, "mtry"] = rf.fit$finalModel$tuneValue
## Predict in independent test set
rf.preds = predict(rf.fit, newdata = test)
# Save fit statistics
fit.stats[fit.stats.index, c("RMSE", "Rsquared", "MAE")] =
postResample(test[, y], rf.preds)
## Save variable importance
rf.varImp = varImp(rf.fit)$importance
# save variable label and order by label
rf.varImp$vars = row.names(rf.varImp)
rf.varImp = arrange(rf.varImp, vars)
# Save importance values
varImp.stats[fit.stats.index, sort(x)] = rf.varImp$Overall
}
# 3 BARTmachine--------------------------------------
if(runBART == TRUE)  {
## Run inner CV
bart.fit = train(x = train[,x], y = train[,y],
method = "bartMachine", metric = "RMSE",
trControl = fitControl,
tuneGrid = bart.tuneGrid
)
## Save index row to save fit.stats output
fit.stats.index = which(fit.stats$num_repeat == repeats &
fit.stats$k == outer &
fit.stats$model == "bart")
## Save final tuning parameters
fit.stats[fit.stats.index, c("num_trees", "k.bart", "alpha", "beta", "nu")] =
bart.fit$finalModel$tuneValue
## Predict in independent test set
bart.preds = predict(bart.fit, newdata = test)
# Save fit statistics
fit.stats[fit.stats.index, c("RMSE", "Rsquared", "MAE")] =
postResample(test[, y], bart.preds)
## Save variable importance
bart.varImp = varImp(bart.fit)$importance
# save variable label and order by label
bart.varImp$vars = row.names(bart.varImp)
bart.varImp = arrange(bart.varImp, vars)
# Save importance values
varImp.stats[fit.stats.index, sort(x)] = bart.varImp$Overall
}
}
}
## Collate output for fit statistics and variable importance in list
output = list(fit = fit.stats, varImp = varImp.stats)
return(output)
}
## Run analysis
set.seed(8)
covariates.base.output = nested.cv(data = dat[ids_with_bdi,],
x = x,
y = "t7_bdi_locf",
k.outer = 5,
k.inner = 5,
num_repeats = 100,
perm.test = FALSE,
runGLMnet = TRUE,
runRF = TRUE,
runSVM = TRUE,
runBART = FALSE)
# Save results
save(covariates.base.output, file = "./Results/covariates.base.output.RData")
model.comparison = expand.grid(model = c("Covariates only", "Cytokines", "Gene-expression",
"Polygenic risk scores", "Combined immunophenotyping"),
covariates = c("Without covariates", "With covariates"))
model.comparison$tval = NA
model.comparison$pval = NA
summary(covariates.base.output$fit)
t.test(cytokine.base.output$fit$RMSE, cytokine.base.perm$fit$RMSE)[, ]
t.test(cytokine.base.output$fit$RMSE, cytokine.base.perm$fit$RMSE)
t.test(cytokine.base.output$fit$RMSE, cytokine.base.perm$fit$RMSE) %>% str()
## Cytokine model
model.comparison[model.comparison$model == "Cytokines" &
model.comparison$covariates == "Without covariates", c("tval", "pval")] =
t.test(cytokine.base.output$fit$RMSE, cytokine.base.perm$fit$RMSE)$statistic
t.test(cytokine.base.output$fit$RMSE, cytokine.base.perm$fit$RMSE)$statistic
## Cytokine model
t.test.output = t.test(cytokine.base.output$fit$RMSE, cytokine.base.perm$fit$RMSE)
model.comparison[model.comparison$model == "Cytokines" &
model.comparison$covariates == "Without covariates", c("tval", "pval")] =
c(t.test.output$statistic, t.test.output$pval)
model.comparison
t.test.output$pval
model.comparison[model.comparison$model == "Cytokines" &
model.comparison$covariates == "Without covariates", c("tval", "pval")]
c(t.test.output$statistic, t.test.output$pval)
## Cytokine model
t.test.output = t.test(cytokine.base.output$fit$RMSE, cytokine.base.perm$fit$RMSE)
t.test.output$pval
t.test.output$p.value
## Cytokine model
t.test.output = t.test(cytokine.base.output$fit$RMSE, cytokine.base.perm$fit$RMSE)
model.comparison[model.comparison$model == "Cytokines" &
model.comparison$covariates == "Without covariates", c("tval", "pval")] =
c(t.test.output$statistic, t.test.output$p.value)
model.comparison
## Run permutation analysis
set.seed(9)
covariates.base.perm = nested.cv(data = dat[ids_with_bdi,],
x = x,
y = "t7_bdi_locf",
k.outer = 5,
k.inner = 5,
num_repeats = 100,
perm.test = TRUE,
runGLMnet = TRUE,
runRF = TRUE,
runBART = FALSE)
save(covariates.base.perm, file = "./Results/covariates.base.perm.RData")
warnings()
## Collate fit statistics
# Add meta-data
covariates.base.output$fit$pred = "Covariates"
covariates.base.output$fit$pred.type = "Prediction"
covariates.base.perm$fit$pred = "Covariates"
covariates.base.perm$fit$pred.type = "Permutation"
# Rowbind data
fit.stats = rbind.data.frame(covariates.base.output$fit,
covariates.base.perm$fit,
cytokine.base.output$fit,
cytokine.base.perm$fit)
## Recode model
fit.stats$algorithm = recode(fit.stats$model,
'glmnet' = "Elastic net regression",
'rf' = "Random forest",
'bart' = "BARTmachine")
## RMSE
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = algorithm, y = RMSE)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.3,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(pred~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 20)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = "RMSE") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## R2
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = algorithm, y = Rsquared)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.3,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(pred~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 0.4)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## R2
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = algorithm, y = Rsquared)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.3,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(pred~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 0.6)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## R2
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = algorithm, y = Rsquared)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.3,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(pred~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 0.5)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## R2
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = pred, y = Rsquared)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.3,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(algorithm~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 0.5)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## RMSE
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = pred, y = RMSE)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.3,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(algorithm~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 20)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = "RMSE") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## RMSE
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = pred, y = RMSE)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.3, size = 2,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(algorithm~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 20)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = "RMSE") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## RMSE
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = pred, y = RMSE)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.3, size = 1,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(algorithm~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 20)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = "RMSE") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## RMSE
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = pred, y = RMSE)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.5, size = 0.8,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_wrap(algorithm~.) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 20)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = "RMSE") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
x
## Define parameters
x = c(cyto_ref$vars, "t0_bdi_std", "sex_std", "age_std")
## Run analysis
set.seed(12)
cytokine.comb.output = nested.cv(data = dat[ids_with_bdi,],
x = x,
y = "t7_bdi_locf",
k.outer = 5,
k.inner = 5,
num_repeats = 10,
perm.test = FALSE,
runGLMnet = TRUE,
runRF = TRUE,
runSVM = TRUE,
runBART = FALSE)
# Save results
save(cytokine.comb.output, file = "./Results/cytokine.comb.output.RData")
## Run permutation analysis
set.seed(13)
cytokine.comb.perm = nested.cv(data = dat[ids_with_bdi,],
x = x,
y = "t7_bdi_locf",
k.outer = 5,
k.inner = 5,
num_repeats = 10,
perm.test = TRUE,
runGLMnet = TRUE,
runRF = TRUE,
runBART = FALSE)
save(cytokine.comb.perm, file = "./Results/cytokine.comb.perm.RData")
## Collate fit statistics
# Add meta-data
covariates.base.output$fit$pred = "Covariates"
covariates.base.output$fit$pred.type = "Prediction"
covariates.base.output$fit$covariates = "Without covariates"
covariates.base.perm$fit$pred = "Covariates"
covariates.base.perm$fit$pred.type = "Permutation"
covariates.base.perm$fit$covariates = "Without covariates"
cytokine.base.output$fit$pred = "Cytokines"
cytokine.base.output$fit$pred.type = "Prediction"
cytokine.base.output$fit$covariates = "Without covariates"
cytokine.base.perm$fit$pred = "Cytokines"
cytokine.base.perm$fit$pred.type = "Permutation"
cytokine.base.perm$fit$covariates = "Without covariates"
cytokine.comb.output$fit$pred = "Cytokines"
cytokine.comb.output$fit$pred.type = "Prediction"
cytokine.comb.output$fit$covariates = "With covariates"
cytokine.comb.perm$fit$pred = "Cytokines"
cytokine.comb.perm$fit$pred.type = "Permutation"
cytokine.comb.perm$fit$covariates = "With covariates"
# Rowbind data
fit.stats = rbind.data.frame(covariates.base.output$fit,
covariates.base.perm$fit,
cytokine.base.output$fit,
cytokine.base.perm$fit,
cytokine.comb.output$fit,
cytokine.comb.perm$fit)
## Recode model
fit.stats$algorithm = recode(fit.stats$model,
'glmnet' = "Elastic net regression",
'rf' = "Random forest",
'bart' = "BARTmachine")
## RMSE
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = pred, y = RMSE)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.5, size = 0.8,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_grid(algorithm~covariates) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 20)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = "RMSE") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
covariates.base.output$fit$pred = "Covariates"
covariates.base.output$fit$pred.type = "Prediction"
covariates.base.output$fit$covariates = "With covariates"
covariates.base.perm$fit$pred = "Covariates"
covariates.base.perm$fit$pred.type = "Permutation"
covariates.base.perm$fit$covariates = "With covariates"
# Rowbind data
fit.stats = rbind.data.frame(covariates.base.output$fit,
covariates.base.perm$fit,
cytokine.base.output$fit,
cytokine.base.perm$fit,
cytokine.comb.output$fit,
cytokine.comb.perm$fit)
## Recode model
fit.stats$algorithm = recode(fit.stats$model,
'glmnet' = "Elastic net regression",
'rf' = "Random forest",
'bart' = "BARTmachine")
## RMSE
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = pred, y = RMSE)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.5, size = 0.8,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_grid(algorithm~covariates) +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 20)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = "RMSE") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
?facet_grid
## RMSE
ggplot(fit.stats[fit.stats$model != "bart",], aes(x = pred, y = RMSE)) +
geom_violin(aes(fill = pred.type), position = position_dodge(width = 0.8),
col = "black", alpha = 0.8) +
stat_boxplot(aes(fill = pred.type), position = position_dodge(width = 0.8),
geom = 'errorbar', width = 0.4) +
geom_boxplot(aes(fill = pred.type), outlier.alpha = 0, alpha = 0.5,
position = position_dodge(width = 0.8), col = "black") +
#geom_dotplot(aes(col = pred.type, fill = pred.type), position = position_dodge(width = 0.8),
#             binaxis = 'y', stackdir = 'center', dotsize = 0.8, stackratio = 1.5,
#             binwidth = 0.2) +
geom_jitter(aes(col = pred.type), alpha = 0.5, size = 0.8,
position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2)) +
facet_grid(algorithm~covariates, scales = "free_x") +
scale_fill_brewer(palette = "Dark2") +
scale_color_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 20)) +
coord_cartesian(expand = FALSE) +
labs(x = "", y = "RMSE") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
