# Set descriptions
output[newrows[2:3], "description"] = paste0("   ", c("Mean (SD)",
"Median (IQR)"))
# Fill Mean (SD)
output[newrows[2], "statistic"] =
paste0(round(mean(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(sd(data[, vars[i]], na.rm = TRUE), round_dec), ")")
# Fill Median (IQR)
output[newrows[3], "statistic"] =
paste0(round(median(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(summary(data[, vars[i]])[2], round_dec), "-",
round(summary(data[, vars[i]])[5], round_dec), ")")
} else      {
# Set descriptions
output[newrows[2:(newrows_end - 1)], "description"] = output.values
# Fill N (%)
for(j in output.values) {
output[output$description == j, "statistic"] =
paste0(sum(data[!is.na(data[, vars[i]]), vars[i]] == j), " (",
round(sum(data[!is.na(data[, vars[i]]), vars[i]] == j) /
nrow_data * 100, round_dec),
"%)")
}
# Add zeroes to output.value descriptions
output[newrows[2:(newrows_end - 1)], "description"] = paste0("   ", output.values)
}
## Set missing N (%)
output[newrows_end, "statistic"] =
paste0(sum(is.na(data[, vars[i]])), " (",
round(sum(is.na(data[, vars[i]])) / nrow_data * 100, round_dec), "%)")
}
output
vars
i = 3
unique(data[,vars[i]])
j
data[!is.na(data[, vars[i]]), vars[i]]
## Get new row numbers
output.type = var.details[i, "output"]
## Get unique values if categorical output.type
if(output.type == "cat")      {
output.values = unique(data[, vars[i]])
output.values = sort(output.values[!is.na(output.values)])
}
output.values
sum(data[!is.na(data[, vars[i]]), vars[i]] == j)
j
j = output.values[1]
sum(data[!is.na(data[, vars[i]]), vars[i]] == j)
paste0(sum(data[!is.na(data[, vars[i]]), vars[i]] == j), " (",
round(sum(data[!is.na(data[, vars[i]]), vars[i]] == j) /
nrow_data * 100, round_dec),
"%)")
output[newrows[2:(newrows_end - 1)], "description"]
## Create empty table
output = data.frame(vars = character(),
description = character(),
statistic = character())
## Get nrow
nrow_data = nrow(data)
for(i in 1:length(vars))    {
## Get new row numbers
output.type = var.details[i, "output"]
newrows_start = nrow(output) + 1
newrows_end = newrows_start + ifelse(output.type == "cont", 3,
var.details[i, "levels"] + 1)
newrows = newrows_start:newrows_end
## Get unique values if categorical output.type
if(output.type == "cat")      {
output.values = unique(data[, vars[i]])
output.values = sort(output.values[!is.na(output.values)])
}
## Create new empty rows
output[newrows,] = NA
## Set vars and labels
output[newrows, "vars"] = vars[i]
output[newrows_start, "description"] = labels[i]
output[newrows_end, "description"] = "   N Missing (%)"
## Write differently for continuous and categorical variables
if(output.type == "cont")     {
# Set descriptions
output[newrows[2:3], "description"] = paste0("   ", c("Mean (SD)",
"Median (IQR)"))
# Fill Mean (SD)
output[newrows[2], "statistic"] =
paste0(round(mean(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(sd(data[, vars[i]], na.rm = TRUE), round_dec), ")")
# Fill Median (IQR)
output[newrows[3], "statistic"] =
paste0(round(median(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(summary(data[, vars[i]])[2], round_dec), "-",
round(summary(data[, vars[i]])[5], round_dec), ")")
} else      {
# Set descriptions
output[newrows[2:(newrows_end - 1)], "description"] = output.values
# Fill N (%)
for(j in output.values) {
output[output$description == j, "statistic"] =
paste0(sum(data[!is.na(data[, vars[i]]), vars[i]] == j), " (",
round(sum(data[!is.na(data[, vars[i]]), vars[i]] == j) /
nrow_data * 100, round_dec),
"%)")
}
# Add zeroes to output.value descriptions
#output[newrows[2:(newrows_end - 1)], "description"] = paste0("   ", output.values)
}
## Set missing N (%)
output[newrows_end, "statistic"] =
paste0(sum(is.na(data[, vars[i]])), " (",
round(sum(is.na(data[, vars[i]])) / nrow_data * 100, round_dec), "%)")
}
output.values
output[newrows[2:(newrows_end - 1)], "description"]
newrows
newrows_end - 1
2:(newrows_end - 1)
(newrows_end - 1)
newroes
newrows
(newrows_end - 1)
newrows_end
2:(newrows_end - 1)
newrows
newrows[which(newrows_end - 1)]
length(newrows)
2:(length(newrows) - 1)
## Create empty table
output = data.frame(vars = character(),
description = character(),
statistic = character())
## Get nrow
nrow_data = nrow(data)
for(i in 1:length(vars))    {
## Get new row numbers
output.type = var.details[i, "output"]
newrows_start = nrow(output) + 1
newrows_end = newrows_start + ifelse(output.type == "cont", 3,
var.details[i, "levels"] + 1)
newrows = newrows_start:newrows_end
## Get unique values if categorical output.type
if(output.type == "cat")      {
output.values = unique(data[, vars[i]])
output.values = sort(output.values[!is.na(output.values)])
}
## Create new empty rows
output[newrows,] = NA
## Set vars and labels
output[newrows, "vars"] = vars[i]
output[newrows_start, "description"] = labels[i]
output[newrows_end, "description"] = "   N Missing (%)"
## Write differently for continuous and categorical variables
if(output.type == "cont")     {
# Set descriptions
output[newrows[2:3], "description"] = paste0("   ", c("Mean (SD)",
"Median (IQR)"))
# Fill Mean (SD)
output[newrows[2], "statistic"] =
paste0(round(mean(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(sd(data[, vars[i]], na.rm = TRUE), round_dec), ")")
# Fill Median (IQR)
output[newrows[3], "statistic"] =
paste0(round(median(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(summary(data[, vars[i]])[2], round_dec), "-",
round(summary(data[, vars[i]])[5], round_dec), ")")
} else      {
# Set descriptions
output[newrows[2:(length(newrows) - 1)], "description"] =
as.character(output.values)
# Fill N (%)
for(j in output.values) {
output[output$description == j, "statistic"] =
paste0(sum(data[!is.na(data[, vars[i]]), vars[i]] == j), " (",
round(sum(data[!is.na(data[, vars[i]]), vars[i]] == j) /
nrow_data * 100, round_dec),
"%)")
}
# Add zeroes to output.value descriptions
output[newrows[2:(length(newrows) - 1)], "description"] =
paste0("   ", output.values)
}
## Set missing N (%)
output[newrows_end, "statistic"] =
paste0(sum(is.na(data[, vars[i]])), " (",
round(sum(is.na(data[, vars[i]])) / nrow_data * 100, round_dec), "%)")
}
output
table(output$description)
unique(output$description)
baselineTable <- function(data, vars, labels = NULL, grouping.var, round_dec = 2)     {
# Set labels
if(is.null(labels)){labels = vars}
# Give error if labels have different length
if(length(labels) != length(vars))  {
stop("labels need to have the same length as vars.")
}
# Infer classes and levels of variables
var.details = data.frame(var = vars,
class = NA,
levels = NA)
for(i in vars) {
var.details[var.details$var == i, "class"] = class(data[, i])
var.details[var.details$var == i, "levels"] = length(unique(data[!is.na(data[, i]), i]))
}
# Define table class
var.details$output = ifelse(var.details$class %in% c("numeric", "integer") &
var.details$levels > 2, "cont", "cat")
## Create output table
output = createOutputTable(data = data, vars = vars, labels = labels,
grouping.var = grouping.var, round_dec = round_dec)
## Return output
return(output)
}
createOutputTable <- function(data, vars, labels, var.details, grouping.var, round_dec)   {
## Create empty table
output = data.frame(vars = character(),
description = character(),
statistic = character())
## Get nrow
nrow_data = nrow(data)
for(i in 1:length(vars))    {
## Get new row numbers
output.type = var.details[i, "output"]
newrows_start = nrow(output) + 1
newrows_end = newrows_start + ifelse(output.type == "cont", 3,
var.details[i, "levels"] + 1)
newrows = newrows_start:newrows_end
## Get unique values if categorical output.type
if(output.type == "cat")      {
output.values = unique(data[, vars[i]])
output.values = sort(output.values[!is.na(output.values)])
}
## Create new empty rows
output[newrows,] = NA
## Set vars and labels
output[newrows, "vars"] = vars[i]
output[newrows_start, "description"] = labels[i]
output[newrows_end, "description"] = "   N Missing (%)"
## Write differently for continuous and categorical variables
if(output.type == "cont")     {
# Set descriptions
output[newrows[2:3], "description"] = paste0("   ", c("Mean (SD)",
"Median (IQR)"))
# Fill Mean (SD)
output[newrows[2], "statistic"] =
paste0(round(mean(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(sd(data[, vars[i]], na.rm = TRUE), round_dec), ")")
# Fill Median (IQR)
output[newrows[3], "statistic"] =
paste0(round(median(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(summary(data[, vars[i]])[2], round_dec), "-",
round(summary(data[, vars[i]])[5], round_dec), ")")
} else      {
# Set descriptions
output[newrows[2:(length(newrows) - 1)], "description"] =
as.character(output.values)
# Fill N (%)
for(j in output.values) {
output[output$description == j, "statistic"] =
paste0(sum(data[!is.na(data[, vars[i]]), vars[i]] == j), " (",
round(sum(data[!is.na(data[, vars[i]]), vars[i]] == j) /
nrow_data * 100, round_dec),
"%)")
}
# Add zeroes to output.value descriptions
output[newrows[2:(length(newrows) - 1)], "description"] =
paste0("   ", output.values)
}
## Set missing N (%)
output[newrows_end, "statistic"] =
paste0(sum(is.na(data[, vars[i]])), " (",
round(sum(is.na(data[, vars[i]])) / nrow_data * 100, round_dec), "%)")
}
}
# Create necessary variables
dat$sex = ifelse(data$gender == 1, "male", "female")
data = dat
colnames(dat)
dat$schul
dat$taf_ss = rowSums(dat[, paste0("taf_", 8:10)], na.rm = TRUE)
data = dat
# Test
baselineTable(data = dat,
vars = c("sex", "age", "student", "taf_ss"),
labels = c("Sex", "Age", "Student Status", "TAF (Self-Suicidal)"))
baselineTable <- function(data, vars, labels = NULL, grouping.var, round_dec = 2)     {
# Set labels
if(is.null(labels)){labels = vars}
# Give error if labels have different length
if(length(labels) != length(vars))  {
stop("labels need to have the same length as vars.")
}
# Infer classes and levels of variables
var.details = data.frame(var = vars,
class = NA,
levels = NA)
for(i in vars) {
var.details[var.details$var == i, "class"] = class(data[, i])
var.details[var.details$var == i, "levels"] = length(unique(data[!is.na(data[, i]), i]))
}
# Define table class
var.details$output = ifelse(var.details$class %in% c("numeric", "integer") &
var.details$levels > 2, "cont", "cat")
## Create output table
output = createOutputTable(data = data, vars = vars, labels = labels,
var.details = var.details,
grouping.var = grouping.var, round_dec = round_dec)
## Return output
return(output)
}
# Test
baselineTable(data = dat,
vars = c("sex", "age", "student", "taf_ss"),
labels = c("Sex", "Age", "Student Status", "TAF (Self-Suicidal)"))
# Test
baselineTable(data = dat,
vars = c("sex", "age", "student", "taf_ss"),
labels = c("Sex", "Age", "Student Status", "TAF (Self-Suicidal)"))
baselineTable <- function(data, vars, labels = NULL, grouping.var, round_dec = 2)     {
# Set labels
if(is.null(labels)){labels = vars}
# Give error if labels have different length
if(length(labels) != length(vars))  {
stop("labels need to have the same length as vars.")
}
# Infer classes and levels of variables
var.details = data.frame(var = vars,
class = NA,
levels = NA)
for(i in vars) {
var.details[var.details$var == i, "class"] = class(data[, i])
var.details[var.details$var == i, "levels"] = length(unique(data[!is.na(data[, i]), i]))
}
# Define table class
var.details$output = ifelse(var.details$class %in% c("numeric", "integer") &
var.details$levels > 2, "cont", "cat")
## Create output table
output = createOutputTable(data = data, vars = vars, labels = labels,
var.details = var.details,
grouping.var = grouping.var, round_dec = round_dec)
## Return output
return(output)
}
# Test
baselineTable(data = dat,
vars = c("sex", "age", "student", "taf_ss"),
labels = c("Sex", "Age", "Student Status", "TAF (Self-Suicidal)"))
# Set labels
if(is.null(labels)){labels = vars}
# Give error if labels have different length
if(length(labels) != length(vars))  {
stop("labels need to have the same length as vars.")
}
labels = c("Sex", "Age", "Student Status", "TAF (Self-Suicidal)")
vars = c("sex", "age", "student", "taf_ss")
# Infer classes and levels of variables
var.details = data.frame(var = vars,
class = NA,
levels = NA)
for(i in vars) {
var.details[var.details$var == i, "class"] = class(data[, i])
var.details[var.details$var == i, "levels"] = length(unique(data[!is.na(data[, i]), i]))
}
# Define table class
var.details$output = ifelse(var.details$class %in% c("numeric", "integer") &
var.details$levels > 2, "cont", "cat")
var.details
round_dec
createOutputTable(data = data, vars = vars, labels = labels,
var.details = var.details,
grouping.var = grouping.var, round_dec = round_dec)
createOutputTable <- function(data, vars, labels, var.details, grouping.var, round_dec)   {
## Create empty table
output = data.frame(vars = character(),
description = character(),
statistic = character())
## Get nrow
nrow_data = nrow(data)
for(i in 1:length(vars))    {
## Get new row numbers
output.type = var.details[i, "output"]
newrows_start = nrow(output) + 1
newrows_end = newrows_start + ifelse(output.type == "cont", 3,
var.details[i, "levels"] + 1)
newrows = newrows_start:newrows_end
## Get unique values if categorical output.type
if(output.type == "cat")      {
output.values = unique(data[, vars[i]])
output.values = sort(output.values[!is.na(output.values)])
}
## Create new empty rows
output[newrows,] = NA
## Set vars and labels
output[newrows, "vars"] = vars[i]
output[newrows_start, "description"] = labels[i]
output[newrows_end, "description"] = "   N Missing (%)"
## Write differently for continuous and categorical variables
if(output.type == "cont")     {
# Set descriptions
output[newrows[2:3], "description"] = paste0("   ", c("Mean (SD)",
"Median (IQR)"))
# Fill Mean (SD)
output[newrows[2], "statistic"] =
paste0(round(mean(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(sd(data[, vars[i]], na.rm = TRUE), round_dec), ")")
# Fill Median (IQR)
output[newrows[3], "statistic"] =
paste0(round(median(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(summary(data[, vars[i]])[2], round_dec), "-",
round(summary(data[, vars[i]])[5], round_dec), ")")
} else      {
# Set descriptions
output[newrows[2:(length(newrows) - 1)], "description"] =
as.character(output.values)
# Fill N (%)
for(j in output.values) {
output[output$description == j, "statistic"] =
paste0(sum(data[!is.na(data[, vars[i]]), vars[i]] == j), " (",
round(sum(data[!is.na(data[, vars[i]]), vars[i]] == j) /
nrow_data * 100, round_dec),
"%)")
}
# Add zeroes to output.value descriptions
output[newrows[2:(length(newrows) - 1)], "description"] =
paste0("   ", output.values)
}
## Set missing N (%)
output[newrows_end, "statistic"] =
paste0(sum(is.na(data[, vars[i]])), " (",
round(sum(is.na(data[, vars[i]])) / nrow_data * 100, round_dec), "%)")
}
## Return output
return(output)
}
# Test
baselineTable(data = dat,
vars = c("sex", "age", "student", "taf_ss"),
labels = c("Sex", "Age", "Student Status", "TAF (Self-Suicidal)"))
baselineTable <- function(data, vars, labels = NULL, grouping.var, round_dec = 2,
print.vars = FALSE)     {
# Set labels
if(is.null(labels)){labels = vars}
# Give error if labels have different length
if(length(labels) != length(vars))  {
stop("labels need to have the same length as vars.")
}
# Infer classes and levels of variables
var.details = data.frame(var = vars,
class = NA,
levels = NA)
for(i in vars) {
var.details[var.details$var == i, "class"] = class(data[, i])
var.details[var.details$var == i, "levels"] = length(unique(data[!is.na(data[, i]), i]))
}
# Define table class
var.details$output = ifelse(var.details$class %in% c("numeric", "integer") &
var.details$levels > 2, "cont", "cat")
## Create output table
output = createOutputTable(data = data, vars = vars, labels = labels,
var.details = var.details,
grouping.var = grouping.var, round_dec = round_dec)
if(print.vars == FALSE) {output$vars = NULL}
## Return output
return(output)
}
# Test
baselineTable(data = dat,
vars = c("sex", "age", "student", "taf_ss"),
labels = c("Sex", "Age", "Student Status", "TAF (Self-Suicidal)"),
round_dec = 2)
data(cars)
head(cars)
## Load test data
data(cars)
?cars
summary(cars$speed)
cars$speed_cat = ifelse(cars$speed > 15, "Fast Car", "Slow Car")
## Load test data
data(cars)
cars$speed_cat = ifelse(cars$speed > 15, "Fast Car", "Slow Car")
# Test
baselineTable(data = cars,
vars = c("dist", "speed", "speed_cat"),
labels = c("Stopping distance (ft)", "Speed (mph)", "Speed (group)"))
# Test
baselineTable(data = cars, vars = c("dist", "speed", "speed_cat"),
labels = c("Stopping distance (ft)", "Speed (mph)", "Speed (group)"))
.libPaths("C:/Users/nkapp/R")
## Load packages
library("tidyverse")
library("RColorBrewer")
library("caret")
library("HDclassif")
library("glmnet")
.libPaths()
.libPaths("C:/Users/nkapp/R")
library("devtools")
install_github("nkappelmann/PubHelper")
## Load packages
library("tidyverse")
library("RColorBrewer")
library("caret")
library("HDclassif")
library("glmnet")
library("PubHelper")
?trainControl
save(dat, file = "")
?train
library("caret")
?caret::train
log(1.24)
exp(-log(1.24))
citation("PubHelper")
