theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## Plot
ggplot(vis_dat, aes(x = method, y = abs_residuals, fill = model, group = model)) +
geom_boxplot(aes(fill = model), alpha = 0.8, position = position_dodge(width = 0.8)) +
geom_jitter(aes(fill = model), shape = 21, col = "black",
position = position_jitterdodge(dodge.width = 0.8)) +
scale_fill_brewer(palette = "Dark2") +
labs(x = "Model", y = "Absolute Residuals") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## Plot
ggplot(vis_dat, aes(x = method, y = abs_residuals)) +
geom_boxplot(aes(fill = model), alpha = 0.8, position = position_dodge(width = 0.8)) +
geom_jitter(aes(fill = model), shape = 21, col = "black",
position = position_jitterdodge(dodge.width = 0.8)) +
scale_fill_brewer(palette = "Dark2") +
labs(x = "Model", y = "Absolute Residuals") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
?geom_boxplot
## Plot
ggplot(vis_dat, aes(x = method, y = abs_residuals)) +
geom_boxplot(aes(fill = model), alpha = 0.8, position = position_dodge(width = 0.8),
outlier.alpha = 0) +
geom_jitter(aes(fill = model), shape = 21, col = "black",
position = position_jitterdodge(dodge.width = 0.8)) +
scale_fill_brewer(palette = "Dark2") +
labs(x = "Model", y = "Absolute Residuals") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## Plot
ggplot(vis_dat, aes(x = method, y = abs_residuals)) +
geom_boxplot(aes(fill = model), alpha = 0.6, position = position_dodge(width = 0.8),
outlier.alpha = 0) +
geom_jitter(aes(fill = model), shape = 21, col = "black",
position = position_jitterdodge(dodge.width = 0.8)) +
scale_fill_brewer(palette = "Dark2") +
labs(x = "Model", y = "Absolute Residuals") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
ggplot(fit.stats, aes(x = method, y = r2)) +
geom_bar(aes(fill = model), stat = "identity", position = position_dodge()) +
scale_fill_brewer(palette = "Dark2") +
labs(x = "Model", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
ggplot(fit.stats, aes(x = method, y = r2)) +
geom_bar(aes(fill = model), stat = "identity", position = position_dodge(), col = "black") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "Model", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
?scale_y_continuous
ggplot(fit.stats, aes(x = method, y = r2)) +
geom_bar(aes(fill = model), stat = "identity", position = position_dodge(), col = "black") +
scale_fill_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 0.2))
ggplot(fit.stats, aes(x = method, y = r2)) +
geom_bar(aes(fill = model), stat = "identity", position = position_dodge(), col = "black") +
scale_fill_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 0.2)) +
labs(x = "Model", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
ggplot(fit.stats, aes(x = method, y = r2)) +
geom_bar(aes(fill = model), stat = "identity", position = position_dodge(), col = "black") +
scale_fill_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 0.15)) +
coord_cartesian(expand = NULL) +
labs(x = "Model", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
ggplot(fit.stats, aes(x = method, y = r2)) +
geom_bar(aes(fill = model), stat = "identity", position = position_dodge(), col = "black") +
scale_fill_brewer(palette = "Dark2") +
scale_y_continuous(limits = c(0, 0.15)) +
coord_cartesian(expand = FALSE) +
labs(x = "Model", y = expression(R^2)) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
.libPaths("C:/Users/nkapp/R")
library("devtools")
install_github("nkappelmann/PubHelper")
library("PubHelper")
100*230
.libPaths("C:/Users/nkapp/R")
library("RColorBrewer")
brewer.pal(10, "Dark2")
brewer.pal(8, "Dark2")
27-25
?trainControl
library("caret")
?trainControl
fitControl = trainControl(method = "repeatedCV",
number = 10,
repeats = 10)
## Define trainControl
fitControl = trainControl(method = "repeatedcv",
number = 10,
repeats = 10)
114/10
114/5
114-11.4
114-22.8
.libPaths("C:/Users/nkapp/R")
summary(dat$hsCRP)
## Load packages
library("tidyverse")
library("ggcorrplot")
library("RColorBrewer")
library("caret")
library("glmnet")
library("PubHelper")
load("./Data/OPTIMA_Cytokine_PreprocessedData.RData")
load("./Data/Cytokine_Reference.RData")
x = cyto_ref[cyto_ref$no.na == 1, "vars"]
y = "bdi_locf_improve"
covariates = c("age_std", "sex_std")
## Define trainControl
fitControl = trainControl(method = "repeatedcv",
number = 10,
repeats = 10)
## Baseline Table of clinical and sociodemographic characteristics
Table1 = baselineTable(dat, round_dec = 2, placeholder = "   ", grouping.var = "hsCRP_inflamed",
vars = c("sex", "age", "socialclass_cat",
"countryorigin", "ethnicity", "employed",
"t0_bdi", "t0_madrs", "t0_bsi_depr",
"ward_type",
"t0_cidi_diagnsum"),
labels = c("Sex", "Age", "Social class",
"Country of Origin", "Ethnicity", "Employment status",
"BDI", "MADRS", "BSI: Depression",
"Hospitalisation in",
"Number of psychiatric diagnoses"))
Table1
baselineTable(dat, round_dec = 2, placeholder = "   ",
grouping.var = "hsCRP_inflamed",
vars = cyto_ref$vars,
labels = cyto_ref$labels)
cyto_ref$labels
load("./Data/Cytokine_Reference.RData")
load("./Data/OPTIMA_Cytokine_PreprocessedData.RData")
Table1 = baselineTable(dat, round_dec = 2, placeholder = "   ", grouping.var = "hsCRP_inflamed",
vars = c("sex", "age", "socialclass_cat",
"countryorigin", "ethnicity", "employed",
"t0_bdi", "t0_madrs", "t0_bsi_depr",
"ward_type",
"t0_cidi_diagnsum"),
labels = c("Sex", "Age", "Social class",
"Country of Origin", "Ethnicity", "Employment status",
"BDI", "MADRS", "BSI: Depression",
"Hospitalisation in",
"Number of psychiatric diagnoses"))
Table1
## Baseline Tables of inflammatory parameters
TableS1 = baselineTable(dat, round_dec = 2, placeholder = "   ",
grouping.var = "hsCRP_inflamed",
vars = cyto_ref$vars,
labels = cyto_ref$labels)
TableS1
exportPubHelpercsv(Table1, file = "./Results/Table1.csv")
exportPubHelpercsv(TableS1, file = "./Results/TableS1.csv")
## Save correlation matrix and p-value matrix
cyto_cor = cor(dat[, cyto_ref$vars], use = "pairwise.complete.obs", method = "pearson")
cyto_cor_pmat = cor_pmat(dat[, cyto_ref$vars])
## Set labels
colnames(cyto_cor) = cyto_ref$labels
rownames(cyto_cor) = cyto_ref$labels
colnames(cyto_cor_pmat) = cyto_ref$labels
rownames(cyto_cor_pmat) = cyto_ref$labels
# Reduce to those cytokines with no missing values (i.e., used in analyses)
cyto_cor = cyto_cor[row.names(cyto_cor) %in% cyto_ref[cyto_ref$no.na == 1, "labels"],
colnames(cyto_cor) %in% cyto_ref[cyto_ref$no.na == 1, "labels"]]
cyto_cor_pmat = cyto_cor_pmat[row.names(cyto_cor_pmat) %in% cyto_ref[cyto_ref$no.na == 1, "labels"],
row.names(cyto_cor_pmat) %in% cyto_ref[cyto_ref$no.na == 1, "labels"]]
## Export with width=; height=
ggcorrplot(cyto_cor,
hc.order = TRUE, type = "lower",
legend.title = "", show.legend = TRUE,
#p.mat = cyto_cor_pmat,
outline.col = "white", lab = TRUE, digits = 1, lab_size = 3,
#ggtheme = ggplot2::theme_minimal(),
colors = c(brewer.pal(3, "Dark2")[1], "white", brewer.pal(3, "Dark2")[2]))
## Save predictors, covariates, and outcome variables
x = cyto_ref[cyto_ref$no.na == 1, "vars"]
y = "bdi_locf_improve"
covariates = c("age_std", "sex_std")
## Define trainControl
fitControl = trainControl(method = "repeatedcv",
number = 10,
repeats = 10)
## Create empty data.frame to extract fit statistics
fit.stats = data.frame(method = character(),
model = character(),
r2 = numeric(),
rmse = numeric(),
stringsAsFactors = FALSE)
set.seed(1)
model.null.enet = train(x = dat[,c(x, covariates)], y = sample(dat[,y], replace = FALSE),
method = "glmnet", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.null.enet)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Elastic Net", "Null")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.null.enet$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
set.seed(1)
model.base.enet = train(x = dat[,covariates], y = dat[,y],
method = "glmnet", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.base.enet)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Elastic Net", "Baseline")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.base.enet$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
## Save LOOCF predictions
tuningvalues = as.numeric(model.base.enet$finalModel$tuneValue)
dat$pred.base.enet = model.base.enet$pred %>%
filter(alpha == tuningvalues[1] & lambda == tuningvalues[2]) %>%
arrange(rowIndex) %>% pull(pred)
model.base.enet$pred
model.base.enet
set.seed(1)
model.unadj.enet = train(x = dat[,x], y = dat[,y],
method = "glmnet", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.unadj.enet)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Elastic Net", "Cytokines")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.unadj.enet$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
## Save LOOCF predictions
tuningvalues = as.numeric(model.unadj.enet$finalModel$tuneValue)
dat$pred.unadj.enet = model.unadj.enet$pred %>%
filter(alpha == tuningvalues[1] & lambda == tuningvalues[2]) %>%
arrange(rowIndex) %>% pull(pred)
model.unadj.enet$finalModel$tuneValue
tuningValues
tuningvalues[1]
model.unadj.enet$pred %>%
filter(alpha == tuningvalues[1] & lambda == tuningvalues[2])
library("tidyverse")
model.unadj.enet$pred %>%
filter(alpha == tuningvalues[1] & lambda == tuningvalues[2])
library("dplyr")
model.unadj.enet$pred %>%
filter(alpha == tuningvalues[1] & lambda == tuningvalues[2])
?filter
model.unadj.enet$pred
str(model.base.enet)
str(model.unadj.enet)
names(model.unadj.enet)
model.unadj.enet$pred
fitControl
?trainControl
## Define trainControl
fitControl = trainControl(method = "repeatedcv",
number = 10,
repeats = 10,
savePredictions = TRUE)
set.seed(1)
model.null.enet = train(x = dat[,c(x, covariates)], y = sample(dat[,y], replace = FALSE),
method = "glmnet", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.null.enet)
## Create empty data.frame to extract fit statistics
fit.stats = data.frame(method = character(),
model = character(),
r2 = numeric(),
rmse = numeric(),
stringsAsFactors = FALSE)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Elastic Net", "Null")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.null.enet$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
set.seed(1)
model.base.enet = train(x = dat[,covariates], y = dat[,y],
method = "glmnet", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.base.enet)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Elastic Net", "Baseline")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.base.enet$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
## Save LOOCF predictions
tuningvalues = as.numeric(model.base.enet$finalModel$tuneValue)
dat$pred.base.enet = model.base.enet$pred %>%
filter(alpha == tuningvalues[1] & lambda == tuningvalues[2]) %>%
arrange(rowIndex) %>% pull(pred)
model.base.enet$pred %>%
filter(alpha == tuningvalues[1] & lambda == tuningvalues[2]) %>%
arrange(rowIndex) %>% pull(pred)
head(model.base.enet$pred %>%
filter(alpha == tuningvalues[1] & lambda == tuningvalues[2]) %>%
arrange(rowIndex))
set.seed(1)
model.unadj.enet = train(x = dat[,x], y = dat[,y],
method = "glmnet", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.unadj.enet)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Elastic Net", "Cytokines")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.unadj.enet$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
set.seed(1)
model.adj.enet = train(x = dat[,c(x, covariates)], y = dat[,y],
method = "glmnet", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.adj.enet)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Elastic Net", "Baseline+Cytokines")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.adj.enet$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
set.seed(1)
model.null.rf = train(x = dat[,c(x, covariates)], y = sample(dat[,y], replace = FALSE),
method = "rf", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.null.rf)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Random Forest", "Null")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.null.rf$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
set.seed(1)
model.base.rf = train(x = dat[,covariates], y = dat[,y],
method = "rf", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.base.rf)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Random Forest", "Baseline")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.base.rf$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
set.seed(1)
model.unadj.rf = train(x = dat[,x], y = dat[,y],
method = "rf", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.unadj.rf)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Random Forest", "Cytokines")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.unadj.rf$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
set.seed(1)
model.adj.rf = train(x = dat[,c(x, covariates)], y = dat[,y],
method = "rf", metric = "RMSE", #alpha = 0.5,
trControl = fitControl)
print(model.adj.rf)
## Save fit statistics
fit.stats[nrow(fit.stats) + 1, ] = NA
fit.stats[nrow(fit.stats), c("method", "model")] = c("Random Forest", "Baseline+Cytokines")
fit.stats[nrow(fit.stats), c("rmse", "r2")] = model.adj.rf$results %>%
filter(RMSE == min(RMSE)) %>%
select(RMSE, Rsquared)
fit.stats
y
covariates
varImp(model.unadj.enet)
fit.stats
.libPaths("C:/Users/nkapp/R")
## Load packages
library("tidyverse")
library("ggcorrplot")
library("RColorBrewer")
library("caret")
library("glmnet")
library("PubHelper")
load("./Data/OPTIMA_Cytokine_PreprocessedData.RData")
load("./Data/Cytokine_Reference.RData")
head(cyto_ref)
## Get complete data proportion per cytokine
cyto_ref$perc.complete = (nrow(dat) - cyto_ref$na.sum) / nrow(dat) * 100
cyto_ref
head(cyto_ref)
## Get complete variable
cyto_ref$complete = ifelse(cyto_ref$no.na == 1, "Complete", "Not Complete")
head(cyto_ref)
## Create barplot
ggplot(cyto_ref, aes(x = labels, y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black") +
scale_fill_brewer(palette = "Dark2") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank(),
axis.ticks.x = element_text(angle = 0.45))
## Create barplot
ggplot(cyto_ref, aes(x = labels, y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank(),
axis.ticks.x = element_text(angle = 0.45))
?theme
str(cyto_ref)
## Create barplot
ggplot(arrange(cyto_ref, perc),
aes(x = labels, y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = ) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank(),
axis.text.x = element_text(angle = 0.45))
arrange(cyto_ref, perc)
## Create barplot
ggplot(cyto_ref, aes(x = labels, y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = ) +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank(),
axis.text.x = element_text(angle = 0.45))
## Create barplot
ggplot(cyto_ref, aes(x = labels, y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = "Complete Data (%)") +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank(),
axis.text.x = element_text(angle = 0.45))
## Create barplot
ggplot(cyto_ref, aes(x = labels, y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = "Complete Data (%)") +
coord_flip() +
theme_bw() +
theme(legend.position = "top",
legend.title = element_blank())
## Create barplot
ggplot(cyto_ref, aes(x = labels, y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = "Complete Data (%)") +
coord_flip() +
theme_bw() +
theme(legend.position = "none",
legend.title = element_blank())
## Create barplot
ggplot(cyto_ref, aes(x = reorder(labels, -perc.complete), y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = "Complete Data (%)") +
coord_flip() +
theme_bw() +
theme(legend.position = "none",
legend.title = element_blank())
## Create barplot
ggplot(cyto_ref, aes(x = reorder(labels, perc.complete), y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = "Complete Data (%)") +
coord_flip() +
theme_bw() +
theme(legend.position = "none",
legend.title = element_blank())
## Create barplot
ggplot(cyto_ref, aes(x = reorder(labels, perc.complete, labels),
y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = "Complete Data (%)") +
coord_flip() +
theme_bw() +
theme(legend.position = "none",
legend.title = element_blank())
## Create barplot
ggplot(cyto_ref, aes(x = reorder(labels, perc.complete), y = perc.complete, fill = complete)) +
geom_bar(aes(fill = complete), col = "black", stat = "identity") +
scale_fill_brewer(palette = "Dark2") +
labs(x = "", y = "Complete Data (%)") +
coord_flip() +
theme_bw() +
theme(legend.position = "none",
legend.title = element_blank())
2*(sqrt(0.9)-sqrt(0.6))
.libPaths("C:/Users/nkapp/R")
(168.40-164.3)*6
(93.09-87.16)*16
?pdf
